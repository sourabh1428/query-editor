# Render Deployment Guide

This guide explains how to deploy the SQL Analytics Platform to Render.

## Architecture

The application is deployed as two separate services on Render:
- **Frontend**: React app served by Nginx
- **Backend**: Flask API with PostgreSQL database

## Deployment Steps

### 1. Prerequisites
- GitHub repository with your code
- Render account (free tier available)

### 2. Database Setup
The PostgreSQL database is automatically created via `render.yaml`:
- Service name: `sql-analytics-db`
- Plan: Free tier
- Connection details are automatically provided to the backend

### 3. Backend Deployment
- Service name: `sql-analytics-platform-api`
- Docker image built from `backend/Dockerfile`
- Environment variables:
  - `JWT_SECRET`: Auto-generated
  - `DATABASE_URL`: Auto-linked to PostgreSQL service
  - `FLASK_APP`: app.py
  - `FLASK_ENV`: production
  - `FRONTEND_URL`: URL of frontend service for CORS

### 4. Frontend Deployment
- Service name: `sql-analytics-platform`
- Docker image built from root `Dockerfile`
- Environment variables:
  - `VITE_API_URL`: Points to backend service
  - `NODE_ENV`: production

## Configuration Files

### Key Files:
- `render.yaml`: Service definitions
- `Dockerfile`: Frontend build configuration
- `backend/Dockerfile`: Backend build configuration
- `nginx.conf`: Web server configuration

### Environment Variables:
```yaml
# Frontend
VITE_API_URL=https://sql-analytics-platform-api.onrender.com

# Backend
FRONTEND_URL=https://sql-analytics-platform.onrender.com
DATABASE_URL=<auto-generated>
JWT_SECRET=<auto-generated>
```

## Manual Deployment

If you prefer manual deployment:

### 1. Create Services in Render Dashboard:

#### Backend Service:
- Type: Web Service
- Environment: Docker
- Dockerfile Path: `./backend/Dockerfile`
- Build Command: (auto-detected)
- Start Command: (auto-detected)

#### Frontend Service:
- Type: Web Service
- Environment: Docker
- Dockerfile Path: `./Dockerfile`
- Build Command: (auto-detected)
- Start Command: (auto-detected)

#### Database Service:
- Type: PostgreSQL
- Plan: Free

### 2. Set Environment Variables:
Configure the environment variables as specified in `render.yaml`

## Development vs Production

The application automatically detects the environment:- **Development**: Uses `http://localhost:5000` → constructs `http://localhost:5000/api/*`- **Production**: Uses `https://sql-analytics-platform-api.onrender.com` → constructs `https://sql-analytics-platform-api.onrender.com/api/*`

## Troubleshooting

### Common Issues:

1. **CORS Errors**: 
   - Ensure `FRONTEND_URL` is set correctly in backend
   - Check allowed origins in `backend/app.py`

2. **API Connection Failed**:
   - Verify `VITE_API_URL` points to correct backend URL
   - Check backend service is running

3. **Database Connection**:
   - Ensure `DATABASE_URL` is properly set
   - Check PostgreSQL service status

4. **Build Failures**:
   - Check Dockerfile syntax
   - Verify all dependencies are listed
   - Review build logs in Render dashboard

### Health Checks:
- Frontend: `GET /health`
- Backend: `GET /api/health`

## Production URLs

After deployment, your services will be available at:
- Frontend: `https://sql-analytics-platform.onrender.com`
- Backend: `https://sql-analytics-platform-api.onrender.com`
- API Docs: `https://sql-analytics-platform-api.onrender.com/api-docs`

## Notes

- Free tier services may spin down after inactivity
- First request after spin-down may take 10-15 seconds
- Consider upgrading to paid plans for production use
- Database includes automatic backups on paid plans 